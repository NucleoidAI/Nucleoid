<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Nucleoid - Terminal</title>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <style>
      body {
        background-color: #202124;
        font-family: Menlo, Terminal, monospace;
        font-size: 15px;
        color: #ffffff;
      }

      div {
        cursor: default;
      }

      #entry {
        background-color: #202124;
        font-family: Menlo, Terminal, monospace;
        font-size: 15px;
        color: #ffffff;
        cursor: default;
        outline: none;
        border: 0px;
        width: calc(100% - 20.5px);
      }
    </style>

    <script>
      $(function() {
        $("#entry").keypress(function(e) {
          if (e.which === 13) {
            var entry = $("#entry")
              .val()
              .trim();

            if (!entry || entry == "" || entry == null || entry == undefined) {
              display(entry);
              return;
            }

            use: if (entry.startsWith("use ")) {
              let parts = entry.split(/ +/);
              if (parts.length !== 2) break use;

              $.ajaxSetup({
                headers: {
                  Process: parts[1]
                }
              });

              $(`<div>>&nbsp;${entry}</div>`).appendTo("#entries");
              $("#entry").val("");
              return;
            }

            $.post("/", entry, function(response) {
              let string = response;

              if (typeof response === "object") {
                string = JSON.stringify(response);
              } else if (typeof response === "string") {
                string = `'${response}'`;
              }

              display(entry, string);
            }).fail(function(response) {
              if (response.readyState !== 4) {
                display(entry, "Connection lost");
                return;
              }

              if (response.status >= 500) {
                display(entry, `Error: ${response.responseText}`);
              } else {
                display(entry, response.responseJSON);
              }
            });
          }
        });
      });

      function display(entry, string) {
        $(`<div>>&nbsp;${entry}</div>`).appendTo("#entries");

        if (string !== undefined) {
          $(`<div>${string}</div>`).appendTo("#entries");
        }

        $("#entry").val("");
        window.scrollTo(0, document.body.scrollHeight);
      }
    </script>
  </head>
  <body>
    <div id="entries">
      <div>Nucleoid - Declarative Runtime Environment</div>
      <div>https://nucleoid.org/</div>
      <div>&nbsp;</div>
    </div>
    <div><span>></span>&nbsp;<input id="entry" autofocus /></div>
  </body>
</html>
